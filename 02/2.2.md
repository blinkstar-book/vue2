## 2.2 深入 vue-cli 的工程模板

### 2.2.1 webpack-simple 模板

所有的 Vue 代码源程序都放置在 <red>src 目录</red>中，在 webpack 模板中多了 components 目录用于存放公用组件。

这个目录的结构与文件的组织应在开发前就进行约定，对于多人协作式项目，目录的使用与文件的命名都显得尤为重要。

具体约定如下：

（1）公共组件、指令、过滤器（多于三个文件以上的引用）将分别存放于 src 目录下的

- components；
- directives；
- filters。

（2）以使用场景命名 Vue 的页面文件。

（3）当页面文件具有私有组件、指令和过滤器时，则建立一个与页面同名的目录，页面文件更名为 index.vue，将页面与相关的依赖文件放在一起。

（4）目录由全小写的名词、动名词或分词命名，由两个以上的词组成，以“-”进行分隔。

（5）Vue 文件统一以大驼峰命名法命名，仅入口文件 index.vue 采用小写。

（6）测试文件一律以测试目标文件名.spec.js 命名。

（7）资源文件一律以小写字符命名，由两个以上的词组成，以“-”进行分隔。


### 2.2.2 webpack 模板

在上面已经提过 src 目录的用法与约定，在项目的根目录下多了 4 个目录，它们的作用分别如下：

- build——存放用于编译用的 webpack 配置与相关的辅助工具代码；
- config——存放三大环境配置文件，用于设定环境变量和必要的路径信息；
- test——存放 E2E 测试与单元测试文件以及相关的配置文件；
- static——存放项目所需要的其他静态资源文件；
- dist——存放运行 npm run build 指令后的生产环境输出文件，可直接部署到服务器
  对应的静态资源文件夹内，该文件夹只有在运行 build 之后才会生成。


### 2.2.3 构建工具

由于开发、测试与生产三大运行环境都需要进行构建，而且针对不同的环境要求，它
的配置会有一定的区别。

#### 1．编译开发环境

在开发环境下通过以下指令加载运行 Vue 项目：

    $ npm run dev

这个指令的配置是在 package.json 的 script 属性中设置的，实质上它是由 npm 来引导
执行入口程序 dev-server.js 完成以下的加载过程：

##### 加载环境变量

该环节从 config 目录加载 index.js 和 dev.env.js 两个模块，准备开发调试环境所必需的
一些目录和全局变量。

##### 合并 webpack 配置

在 build 目录下一共有三个 webpack 的配置文件：

- webpack.base.conf.js——公用的基本 webpack 配置；
- webpack.dev.conf.js——开发环境专用的 webpack 配置项；
- webpack.prod.conf.js——生产环境专用的 webpack 配置项。

这里使用了一个叫 webpack-merge 的包来进行两个 webpack 配置之间的合并，这个环
节就是通过这个包将webpack.base.conf.js和webpack.dev.conf.js合并成最终终的webpack配置。

##### 配置热加载

热加载是一个非常棒的功能，这个功能启用后的效果就是：当开发环境被启动并进入
调试模式后，一旦我们修改了任意地方的源代码，浏览器中对应的内容就会被自动刷新，
而无须手工对浏览器进行刷新的操作，这个配置将是我们做页面布局或者功能调整时的一
大臂助。

上一个环境中合并的 webpack 配置也是通过这个环节被动态加载的，当代码文件发生变
化，热加载就会启动 webpack 进行重新编译，然后将最新的编译文件重新加载到浏览器中。

##### 配置代理服务器

这个环境是为我们的代码增加一个模拟的服务端做准备，有了它的存在，我们就可以
在没有后端程序支持的情况下，直接模拟远程服务器执行的一些请求的效果。例如，向服
务器发出一个 HTTP GET /api/books/的请求，那么我们就可以利用代理服务器将这一请求截
获下来，然后返回一组这个 API 应该执行成功的返回结果，这样我们的前端程序运行起来
的效果就与接入了服务端后的效果是一致的了。我们将这一技术称为服务模拟。

##### 配置静态资源

将图片、字体、样式表和编译后的 JS 脚本等，生成对应的一些印记（Footprint）并存
放到由开发服务器托管的一个 static 虚目录中，使得我们在浏览器中可以正常访问到这些资
源。每个生成的文件 Footprint 是一些哈希代码，当文件内容发生变化时这些哈希代码就会
发生改变，使用 Footprint 是将静态文件发布到 CDN 或者进行离线缓冲时通知浏览器文件
是否发生改变的重要依据。

##### 加载开发服务器

启动一个 Express 的 Web 服务器，将上述各个环境中配置好的模块进行加载，并使程
序能通过浏览器进行访问。
以上就是 npm run dev 的完整执行思路。

#### 2．编译生产环境

当项目准备发布时，在命令行键入：

    $ npm run build

生产环境的构建过程比较简单，首先是对必要的资源文件进行打包加上 FootPrint，然
后是对脚本进行编译、压缩和包大小的分割。
